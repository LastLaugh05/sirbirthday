<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>A Grand Celebration | Happy Birthday Hemonto Sir</title>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        /* =========================================
           1. CORE VARIABLES & ADVANCED RESET
           ========================================= */
        :root {
            --magic-gold: #ffd700;
            --magic-glow: #ff8c00;
            --deep-void: #020205;
            --nebula-purple: #1a0524;
            --sorrow-blue: #060b19;
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 215, 0, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body, html {
            width: 100%; height: 100%; overflow: hidden;
            background-color: var(--deep-void);
            font-family: 'Montserrat', sans-serif; color: white;
            user-select: none; perspective: 1000px; cursor: crosshair;
        }

        /* =========================================
           2. CINEMATIC OVERLAYS (FILM GRAIN & BOKEH)
           ========================================= */
        .film-grain {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            pointer-events: none; z-index: 9998; opacity: 0.05;
            background-image: url('data:image/svg+xml;utf8,%3Csvg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"%3E%3Cfilter id="noiseFilter"%3E%3CfeTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="3" stitchTiles="stitch"/%3E%3C/filter%3E%3Crect width="100%25" height="100%25" filter="url(%23noiseFilter)"/%3E%3C/svg%3E');
        }

        .bokeh-container {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            pointer-events: none; z-index: 1; overflow: hidden;
        }

        .bokeh-orb {
            position: absolute; border-radius: 50%;
            background: radial-gradient(circle, rgba(255,215,0,0.15) 0%, transparent 70%);
            animation: floatUp 15s linear infinite; filter: blur(5px);
        }

        @keyframes floatUp {
            0% { transform: translateY(110vh) scale(0.5); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(-20vh) scale(1.5); opacity: 0; }
        }

        /* =========================================
           3. DYNAMIC CANVAS & AMBIENT GLOW
           ========================================= */
        #magic-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;
            background: radial-gradient(circle at 50% 50%, var(--sorrow-blue), var(--deep-void));
            transition: background 3s ease;
        }

        #magic-canvas.celebration-mode {
            background: radial-gradient(circle at 50% 50%, var(--nebula-purple), var(--deep-void));
        }

        .ambient-glow {
            position: fixed; width: 200vw; height: 200vh; top: -50vh; left: -50vw;
            background: radial-gradient(circle at 30% 40%, rgba(0, 255, 200, 0.04), transparent 40%),
                        radial-gradient(circle at 70% 60%, rgba(255, 0, 150, 0.04), transparent 40%);
            z-index: 1; pointer-events: none;
            animation: breathe 10s ease-in-out infinite alternate;
            opacity: 0.2; transition: opacity 3s;
        }

        .ambient-glow.active { opacity: 1; }
        @keyframes breathe { 0% { transform: scale(1) rotate(0deg); } 100% { transform: scale(1.15) rotate(5deg); } }

        /* =========================================
           4. SCENE DIRECTOR
           ========================================= */
        .director-stage {
            position: relative; z-index: 10; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
        }

        .scene {
            position: absolute; width: 90%; max-width: 680px; text-align: center;
            opacity: 0; visibility: hidden; pointer-events: none;
            transform: translateZ(-150px) translateY(30px) scale(0.9); filter: blur(20px);
            transition: all 1.8s cubic-bezier(0.25, 1, 0.5, 1);
            display: flex; flex-direction: column; align-items: center;
        }

        .scene.active {
            opacity: 1; visibility: visible; pointer-events: auto;
            transform: translateZ(0) translateY(0) scale(1); filter: blur(0);
        }

        .scene.exit {
            transform: translateZ(200px) translateY(-50px) scale(1.1); opacity: 0; filter: blur(25px);
        }

        /* =========================================
           5. HOLOGRAPHIC TYPOGRAPHY
           ========================================= */
        .fantasy-title {
            font-family: 'Cinzel', serif; font-size: clamp(2rem, 7vw, 3.8rem);
            color: var(--magic-gold); text-shadow: 0 0 25px rgba(255, 215, 0, 0.5);
            line-height: 1.3; margin-bottom: 20px;
        }

        .text-glow-gradient {
            background: linear-gradient(45deg, #ffd700, #ff4500, #ffae00, #ffffff);
            background-size: 300% 300%;
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: gradientShift 6s ease infinite;
            filter: drop-shadow(0 0 20px rgba(255, 140, 0, 0.6));
        }

        @keyframes gradientShift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        .sorry-text {
            font-family: 'Montserrat', sans-serif; font-size: clamp(1.2rem, 5vw, 2.2rem);
            color: rgba(255, 255, 255, 0.9); font-weight: 300; line-height: 1.6;
            text-shadow: 0 0 10px rgba(255,255,255,0.2);
        }

        .fantasy-subtitle {
            font-size: clamp(0.9rem, 3vw, 1.1rem); letter-spacing: 6px;
            text-transform: uppercase; color: rgba(255, 255, 255, 0.6);
            margin-bottom: 15px; animation: floatText 4s ease-in-out infinite;
        }

        @keyframes floatText { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }

        /* =========================================
           6. MAGNETIC BUTTONS (Ripple FX)
           ========================================= */
        .btn-magic {
            position: relative; padding: 18px 50px; margin-top: 35px;
            background: rgba(0, 0, 0, 0.6); border: 1px solid var(--magic-gold);
            color: var(--magic-gold); font-family: 'Cinzel', serif; font-size: 1.1rem;
            letter-spacing: 5px; text-transform: uppercase; cursor: pointer;
            border-radius: 6px; overflow: hidden; backdrop-filter: blur(15px);
            transition: all 0.4s ease; box-shadow: 0 0 30px rgba(255, 215, 0, 0.1);
        }

        .btn-magic::before {
            content: ''; position: absolute; top: 0; left: -150%; width: 150%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.4), transparent);
            transform: skewX(-20deg); transition: left 0.7s ease;
        }

        .btn-magic:hover::before, .btn-magic:active::before { left: 150%; }
        .btn-magic:hover, .btn-magic:active { 
            background: var(--magic-gold); color: black; 
            box-shadow: 0 0 50px var(--magic-glow), 0 0 15px white; transform: scale(1.05); 
        }

        /* =========================================
           7. 3D CAKE PHYSICS
           ========================================= */
        .altar {
            position: relative; margin-bottom: 30px; transform-style: preserve-3d;
            animation: floatAltar 6s ease-in-out infinite;
        }

        @keyframes floatAltar { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

        .cake-asset { font-size: clamp(7rem, 25vw, 12rem); filter: drop-shadow(0 20px 40px rgba(0,0,0,0.8)); transition: all 1s; }
        .cake-asset.ignited { filter: drop-shadow(0 0 120px var(--magic-glow)); transform: scale(1.15); }

        .candle-cluster { position: absolute; top: 0; left: 50%; transform: translateX(-50%); display: flex; gap: 22px; }
        
        .mystic-flame {
            width: 18px; height: 40px;
            background: radial-gradient(ellipse at bottom, #fff 10%, #ffdf00 40%, #ff4500 80%, transparent 100%);
            border-radius: 50% 50% 20% 20%; box-shadow: 0 -15px 30px #ff4500, 0 0 40px #ffdf00;
            animation: flickerMagic 0.08s infinite alternate; transition: all 0.5s ease;
        }

        @keyframes flickerMagic { 0% { transform: scale(1) skewX(-2deg); } 100% { transform: scale(1.15) skewX(2deg); opacity: 0.9; } }
        .flame-extinguished { opacity: 0 !important; transform: translateY(-50px) scale(0) !important; }

        /* =========================================
           8. HOVER GIFT ARTIFACT
           ========================================= */
        .gift-wrapper {
            font-size: clamp(6.5rem, 22vw, 10rem); cursor: pointer;
            filter: drop-shadow(0 0 50px var(--magic-gold));
            animation: hoverGift 3s ease-in-out infinite; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .gift-wrapper:hover { transform: scale(1.1); filter: drop-shadow(0 0 80px white); }
        .gift-wrapper:active { transform: scale(0.8); }
        @keyframes hoverGift { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-20px) rotate(3deg); } }

        /* =========================================
           9. THE MASTERCLASS PHOTO REVEAL 
           ========================================= */
        .enchanted-frame {
            background: var(--glass-bg); padding: 18px; border-radius: 15px;
            border: 2px solid rgba(255, 215, 0, 0.4); backdrop-filter: blur(25px);
            box-shadow: 0 50px 100px rgba(0,0,0,0.9), inset 0 0 50px rgba(255,215,0,0.1);
            max-width: 100%; position: relative; overflow: hidden; transform-style: preserve-3d;
            transition: transform 0.3s ease-out, box-shadow 0.5s ease;
        }

        .enchanted-frame:hover { box-shadow: 0 60px 120px rgba(0,0,0,1), 0 0 80px rgba(255, 215, 0, 0.3); }

        .enchanted-frame::before {
            content: ''; position: absolute; top: 0; left: -150%; width: 60%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: skewX(-25deg); z-index: 5; pointer-events: none; animation: lightSweep 7s infinite;
        }
        @keyframes lightSweep { 0%, 20% { left: -150%; } 80%, 100% { left: 250%; } }

        .image-container {
            overflow: hidden; border-radius: 8px; position: relative;
            border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 15px 40px rgba(0,0,0,0.7);
        }

        .image-container img {
            width: 100%; max-height: 42vh; object-fit: cover; display: block;
            filter: contrast(1.15) brightness(1.05) saturate(1.15); 
            animation: cinematicZoom 18s ease-in-out infinite alternate;
        }
        @keyframes cinematicZoom { 0% { transform: scale(1) translate(0, 0); } 100% { transform: scale(1.15) translate(-2%, 2%); } }

        .typewriter-box {
            margin-top: 30px; font-family: 'Montserrat', sans-serif; font-size: clamp(1rem, 4vw, 1.25rem);
            color: var(--magic-gold); min-height: 140px; line-height: 1.7; font-style: italic; text-align: center;
        }

        .cursor { display: inline-block; width: 3px; background: var(--magic-gold); animation: blink 0.8s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* =========================================
           10. INTERACTIVE FX OVERLAYS & RIPPLES
           ========================================= */
        #gatekeeper {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000;
            z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 1.5s ease;
        }

        .flash-bang {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #ffffff, #ffdf00); z-index: 8000; opacity: 0; pointer-events: none;
            transition: opacity 1.2s ease-out; mix-blend-mode: overlay;
        }

        .shake-screen { animation: earthQuake 0.7s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes earthQuake {
            10%, 90% { transform: translate3d(-4px, 3px, 0); }
            20%, 80% { transform: translate3d(6px, -3px, 0); }
            30%, 50%, 70% { transform: translate3d(-8px, 4px, 0); }
            40%, 60% { transform: translate3d(8px, -4px, 0); }
        }

        /* Click Shockwave CSS */
        .shockwave {
            position: fixed; border-radius: 50%; border: 2px solid rgba(255, 215, 0, 0.8);
            transform: translate(-50%, -50%) scale(0); pointer-events: none; z-index: 9997;
            animation: waveExpand 0.6s ease-out forwards;
        }
        @keyframes waveExpand { to { transform: translate(-50%, -50%) scale(3); opacity: 0; } }

        /* Mouse Trail Particle CSS */
        .trail-particle {
            position: fixed; background: radial-gradient(circle, #fff, #ffd700);
            border-radius: 50%; pointer-events: none; z-index: 9996;
            animation: fadeTrail 0.8s ease-out forwards;
        }
        @keyframes fadeTrail { to { transform: translateY(20px) scale(0); opacity: 0; } }

        @media (max-width: 600px) {
            .btn-magic { width: 90%; font-size: 1rem; padding: 15px; }
            .scene { width: 95%; }
        }
    </style>
</head>
<body>

    <audio id="sfx-bday" src="song.mp3" preload="auto"></audio>

    <div class="film-grain"></div>
    <div class="bokeh-container" id="bokeh-box"></div>
    <canvas id="magic-canvas"></canvas>
    <div class="ambient-glow" id="glow-layer"></div>
    <div class="flash-bang" id="flash"></div>

    <div id="gatekeeper">
        <span class="fantasy-subtitle">Utsha Rudra Presents</span>
        <h1 class="fantasy-title text-glow-gradient" style="margin-top: 10px; font-size: clamp(2.2rem, 9vw, 4rem);">A Grand Celebration</h1>
        <button class="btn-magic" onclick="igniteMasterpiece()">Enter Experience</button>
        <p style="margin-top: 35px; font-size: 0.8rem; color: rgba(255,255,255,0.4); letter-spacing: 3px;">PLEASE TURN ON YOUR SOUND</p>
    </div>

    <div class="director-stage">
        
        <div class="scene" id="scene0">
            <h1 class="sorry-text" id="apology-text">Sir... I know I am a little late.</h1>
        </div>

        <div class="scene" id="scene1">
            <span class="fantasy-subtitle">But the truth is...</span>
            <div id="narrative-text" class="fantasy-title" style="margin-top: 15px;">The teacher who turned 12th‚Äëgrade Biology tuition into an unforgettable experience should be celebrated daily.</div>
        </div>

        <div class="scene" id="scene2">
            <div class="altar" id="cake-altar">
                <div class="candle-cluster">
                    <div class="mystic-flame"></div>
                    <div class="mystic-flame"></div>
                    <div class="mystic-flame"></div>
                </div>
                <div class="cake-asset" id="main-cake">üéÇ</div>
            </div>
            <h2 class="fantasy-title" style="font-size: clamp(1.4rem, 6vw, 2.5rem);">Happy Birthday, Sir.</h2>
            <button class="btn-magic" id="blow-btn" onclick="executeSpellBlow()">Cut the Cake & Make a Wish</button>
        </div>

        <div class="scene" id="scene3">
            <div class="gift-wrapper" onclick="triggerUnboxing()">üéÅ</div>
            <h2 class="fantasy-title" style="font-size: clamp(1.8rem, 7vw, 3.2rem);">A Small Token of Respect</h2>
            <p class="fantasy-subtitle">Tap the gift to unbox</p>
        </div>

        <div class="scene" id="scene4">
            <div class="enchanted-frame" id="photo-frame">
                <div class="image-container">
                    <img src="sir-photo.jpeg" alt="Hemonto Sir">
                </div>
                <div class="typewriter-box">
                    <span id="typed-text"></span><span class="cursor" id="type-cursor">&nbsp;</span>
                </div>
                <p id="author-sig" style="opacity:0; transition: 2.5s; margin-top: 10px; font-weight: 600; color: white; letter-spacing: 2px;">‚Äî Utsha Rudra</p>
            </div>
            <button class="btn-magic" id="finale-btn" style="display:none; margin-top: 30px; font-size: 0.9rem; padding: 15px 40px;" onclick="castGrandFinale()">Reveal Final Surprise</button>
        </div>

        <div class="scene" id="scene5">
            <h1 class="fantasy-title text-glow-gradient" style="font-family: 'Cinzel', serif; font-size: clamp(2.8rem, 12vw, 6rem);">Happy Birthday!</h1>
            <p class="fantasy-subtitle" style="color: var(--magic-gold); font-size: 1.2rem;">‚ÄúMay you always be blessed with happiness, just as you have blessed your students with knowledge.‚Äù</p>
        </div>

    </div>

    <script>
        /* ---------------------------------------------------
           0. BOKEH GENERATOR (Background Depth)
           --------------------------------------------------- */
        function generateBokeh() {
            const container = document.getElementById('bokeh-box');
            for(let i=0; i<15; i++) {
                let orb = document.createElement('div');
                orb.className = 'bokeh-orb';
                let size = Math.random() * 100 + 50;
                orb.style.width = `${size}px`;
                orb.style.height = `${size}px`;
                orb.style.left = `${Math.random() * 100}vw`;
                orb.style.animationDuration = `${Math.random() * 15 + 10}s`;
                orb.style.animationDelay = `${Math.random() * 5}s`;
                container.appendChild(orb);
            }
        }

        /* ---------------------------------------------------
           1. CLICK SHOCKWAVES & MOUSE MAGIC TRAIL
           --------------------------------------------------- */
        document.addEventListener('click', (e) => {
            let wave = document.createElement('div');
            wave.className = 'shockwave';
            wave.style.left = `${e.clientX}px`;
            wave.style.top = `${e.clientY}px`;
            wave.style.width = wave.style.height = '50px';
            document.body.appendChild(wave);
            setTimeout(() => wave.remove(), 600);
        });

        document.addEventListener('mousemove', (e) => {
            if(Math.random() > 0.6) {
                let trail = document.createElement('div');
                trail.className = 'trail-particle';
                trail.style.left = `${e.clientX}px`;
                trail.style.top = `${e.clientY}px`;
                let size = Math.random() * 6 + 2;
                trail.style.width = `${size}px`;
                trail.style.height = `${size}px`;
                document.body.appendChild(trail);
                setTimeout(() => trail.remove(), 800);
            }
        });

        /* ---------------------------------------------------
           2. ADVANCED PARTICLE ENGINE (Shooting Stars)
           --------------------------------------------------- */
        const canvas = document.getElementById('magic-canvas');
        const ctx = canvas.getContext('2d');
        let particlesArray = [];
        let shootingStars = [];
        let timeWarpSpeed = 1;

        function initCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            particlesArray = [];
            const particleCount = window.innerWidth < 600 ? 90 : 180; 

            for (let i = 0; i < particleCount; i++) {
                let size = Math.random() * 2.5;
                let x = Math.random() * canvas.width;
                let y = Math.random() * canvas.height;
                let speedX = (Math.random() - 0.5) * 0.5;
                let speedY = (Math.random() - 0.5) * 0.5;
                let color = 'rgba(180, 200, 255, 0.4)'; 
                particlesArray.push({ x, y, size, speedX, speedY, color, pulse: Math.random() });
            }
        }

        function animateCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            for (let i = 0; i < particlesArray.length; i++) {
                let p = particlesArray[i];
                p.pulse += 0.02;
                ctx.globalAlpha = Math.abs(Math.sin(p.pulse)); 
                ctx.fillStyle = p.color;
                ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2); ctx.fill();

                p.x += (p.speedX * timeWarpSpeed);
                p.y += (p.speedY * timeWarpSpeed);

                if (p.x < 0) p.x = canvas.width;
                if (p.x > canvas.width) p.x = 0;
                if (p.y < 0) p.y = canvas.height;
                if (p.y > canvas.height) p.y = 0;
            }
            ctx.globalAlpha = 1; 

            if(timeWarpSpeed === 1.5 && Math.random() < 0.03) {
                shootingStars.push({ x: Math.random() * canvas.width, y: 0, len: Math.random() * 80 + 20, speed: Math.random() * 10 + 10 });
            }

            for(let i = 0; i < shootingStars.length; i++) {
                let s = shootingStars[i];
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.lineWidth = 1.5; ctx.beginPath();
                ctx.moveTo(s.x, s.y); ctx.lineTo(s.x - s.len, s.y + s.len); ctx.stroke();
                s.x -= s.speed; s.y += s.speed;
                if(s.y > canvas.height) shootingStars.splice(i, 1);
            }
            requestAnimationFrame(animateCanvas);
        }

        function transformToMagic() {
            timeWarpSpeed = 8; 
            setTimeout(() => { timeWarpSpeed = 1.5; }, 1800);
            
            particlesArray.forEach(p => {
                p.color = Math.random() > 0.6 ? 'rgba(255, 215, 0, 0.9)' : 'rgba(255, 255, 255, 0.7)';
            });
            document.getElementById('magic-canvas').classList.add('celebration-mode');
            document.getElementById('glow-layer').classList.add('active');
        }

        window.addEventListener('resize', initCanvas);

        /* ---------------------------------------------------
           3. ADVANCED GYRO/MOUSE 3D PARALLAX
           --------------------------------------------------- */
        const altar = document.getElementById('cake-altar');
        const photoFrame = document.getElementById('photo-frame');
        
        function handleParallax(x, y) {
            if(altar) altar.style.transform = `rotateY(${x}deg) rotateX(${-y}deg)`;
            if(photoFrame && SceneDir.current === 4) {
                photoFrame.style.transform = `rotateY(${x*1.5}deg) rotateX(${-y*1.5}deg)`;
            }
        }

        document.addEventListener('mousemove', (e) => {
            const x = (window.innerWidth / 2 - e.pageX) / 35;
            const y = (window.innerHeight / 2 - e.pageY) / 35;
            handleParallax(x, y);
        });

        if (window.DeviceOrientationEvent) {
            window.addEventListener('deviceorientation', (e) => {
                const x = e.gamma ? e.gamma / 4 : 0;
                const y = e.beta ? (e.beta - 45) / 4 : 0;
                handleParallax(x, y);
            });
        }

        /* ---------------------------------------------------
           4. SCENE DIRECTOR
           --------------------------------------------------- */
        const SceneDir = {
            current: 0,
            next: function() {
                const oldScene = document.getElementById(`scene${this.current}`);
                oldScene.classList.remove('active'); oldScene.classList.add('exit');
                
                this.current++;
                const newScene = document.getElementById(`scene${this.current}`);
                
                setTimeout(() => { oldScene.style.display = 'none'; newScene.classList.add('active'); }, 1200);
            }
        };

        /* ---------------------------------------------------
           5. CINEMATIC ACTION SEQUENCES
           --------------------------------------------------- */
        function igniteMasterpiece() {
            document.getElementById('gatekeeper').style.opacity = '0';
            setTimeout(() => document.getElementById('gatekeeper').style.display = 'none', 1500);

            generateBokeh(); initCanvas(); animateCanvas();
            document.getElementById('scene0').classList.add('active');
            
            const apologyText = document.getElementById('apology-text');
            
            setTimeout(() => {
                apologyText.style.opacity = '0';
                setTimeout(() => { apologyText.innerText = "Please accept my sincere apologies..."; apologyText.style.opacity = '1'; }, 1800);
            }, 4500);

            setTimeout(() => { SceneDir.next(); }, 9500);
            setTimeout(() => { transformToMagic(); SceneDir.next(); }, 15000);
        }

        function executeSpellBlow() {
            document.getElementById('blow-btn').style.opacity = '0';
            document.getElementById('blow-btn').style.pointerEvents = 'none';

            const flash = document.getElementById('flash');
            flash.style.opacity = '1';

            setTimeout(() => {
                flash.style.opacity = '0';
                document.querySelectorAll('.mystic-flame').forEach(f => f.classList.add('flame-extinguished'));
                document.body.classList.add('shake-screen');
                document.getElementById('main-cake').classList.add('ignited');
                
                confetti({ particleCount: 350, spread: 150, origin: { y: 0.6 }, colors: ['#ffd700', '#ffffff', '#ff8c00', '#ff4500'] });

                const bdaySong = document.getElementById('sfx-bday');
                bdaySong.volume = 0; bdaySong.play();
                
                let vol = 0;
                let fade = setInterval(() => {
                    vol = Math.min(0.9, vol + 0.05);
                    bdaySong.volume = vol;
                    if(vol >= 0.9) clearInterval(fade);
                }, 250);

                setTimeout(() => SceneDir.next(), 6500);
            }, 250); 
        }

        function triggerUnboxing() {
            SceneDir.next();
            const end = Date.now() + 2500;
            (function frame() {
                confetti({ particleCount: 6, angle: 60, spread: 60, origin: { x: 0 }, colors: ['#ffd700'] });
                confetti({ particleCount: 6, angle: 120, spread: 60, origin: { x: 1 }, colors: ['#ffffff'] });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());

            setTimeout(startEnchantedTypewriter, 2500);
        }

        const finalMsg = "To the mentor who didn't just teach biology, but sparked a lifelong curiosity. I may be late in saying it, but my gratitude for those tuition days is timeless. Thank you for guiding us, Sir.";
        let charCursor = 0;

        function startEnchantedTypewriter() {
            const textBox = document.getElementById('typed-text');
            if (charCursor < finalMsg.length) {
                textBox.innerHTML += finalMsg.charAt(charCursor);
                charCursor++;
                setTimeout(startEnchantedTypewriter, 45); 
            } else {
                document.getElementById('type-cursor').style.display = 'none'; 
                document.getElementById('author-sig').style.opacity = '1';
                setTimeout(() => document.getElementById('finale-btn').style.display = 'inline-block', 1800);
            }
        }

        function castGrandFinale() {
            SceneDir.next();
            setInterval(function() {
                confetti({
                    particleCount: Math.floor(Math.random() * 60) + 30,
                    angle: Math.random() * 360,
                    spread: Math.random() * 120 + 50,
                    origin: { x: Math.random(), y: Math.random() - 0.2 },
                    colors: ['#ffd700', '#ffae00', '#ffffff', '#ff4500']
                });
            }, 800);
        }
    </script>
</body>
</html>